---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-"
)
```

# spatialsampler: An Implementation of Centric Systematic Area Sampling (CSAS) and Simple Spatial Sampling Method (S3M) in R

[![Travis-CI Build Status](https://travis-ci.org/validmeasures/spatialsampler.svg?branch=master)](https://travis-ci.org/validmeasures/spatialsampler)
[![AppVeyor Build Status](https://ci.appveyor.com/api/projects/status/github/validmeasures/spatialsampler?branch=master&svg=true)](https://ci.appveyor.com/project/validmeasures/spatialsampler)
[![codecov](https://codecov.io/gh/validmeasures/spatialsampler/branch/master/graph/badge.svg)](https://codecov.io/gh/validmeasures/spatialsampler)

The Centric Systematic Area Sampling (CSAS) and the Simple Spatial Survey Method (S3M) are spatial sampling methods adapted and used in health and nutrition surveys by Brixton Health and Valid International. CSAS and S3M are used in surveys designed to be spatially representative i.e., the sample distributed evenly across the survey area, using a spatial sample design that selected communities located closest to the centroids of a square (for CSAS) or hexagonal (for S3M) grid laid over the survey area.

The `spatialsampler` package provides sets of functions for implementing the Centric Systematic Area Sampling (CSAS) and Simple Spatial Sampling Method (S3M) using R.

## Installation

You can install `spatialsampler` from GitHub with:

```{r install1, echo = TRUE, eval = FALSE}
if(!require(devtools)) install.packages("devtools")
devtools::install_github("validmeasures/spatialsampler")
library(spatialsampler)
```

```{r install2, echo = FALSE, eval = TRUE, message = FALSE}
if(!require(devtools)) install.packages("devtools")
devtools::install_github("validmeasures/spatialsampler")
library(spatialsampler)
```

## Usage

### 1. Create a hexagonal sampling grid based on a d of 15 kms

```{r, echo = TRUE, eval = TRUE}
#
# Subset Sudan map to Sennar state map
#
sennar <- subset(sudan01, STATE == "Sennar")
#
# Create sampling grid
#
samp.points <- create_sp_grid(x = sennar, 
                              d = 15, 
                              buffer = 10, 
                              country = "Sudan")
```

`create_sp_grid()` creates 

```{r, echo = TRUE, eval = TRUE}
hex.samp    <- sp::HexPoints2SpatialPolygons(samp.points)
villages.sp <- get_nearest_point(data = sennar_villages, 
                                 data.x = "x", 
                                 data.y = "y", 
                                 query = samp.points, 
                                 duplicate = FALSE)
```

```{r grid1, echo = FALSE, eval = TRUE, fig.cap = "Sampling map of Sennar at d = 15 kms", fig.align = "center", fig.pos = "h", fig.width = 10, fig.height = 10, fig.retina = 1}
raster::plot(sennar, lwd = 1.5)
points(sennar_villages[ , c("x", "y")], pch = 20, cex = 0.7, col = "darkgreen")
raster::plot(hex.samp, lwd = 1, border = "gray70", add = TRUE)
raster::plot(samp.points, pch = 1, cex = 1.75, lwd = 2, col = "blue", bg = NA, add = TRUE)
raster::text(samp.points, labels = 1:nrow(samp.points@coords), cex = 0.6)
points(villages.sp[ , c("x", "y")], pch = 4, cex = 0.7, col = "red")
text(villages.sp[ , c("x", "y")], labels = villages.sp$spid, cex = 0.7)
```


```{r grid2, echo = FALSE, eval = TRUE, fig.cap = "Sampling map of Sennar at d = 15 kms with buffering", fig.align = "center", fig.pos = "h", fig.width = 10, fig.height = 10, fig.retina = 1}
sennar_grid <- spatialsampler::create_sp_grid(x = sennar, d = 15, country = "Sudan")
raster::plot(sennar, lwd = 1.5)
raster::plot(sennar_grid, pch = 4, lwd = 2, col = "red", add = TRUE)
points(sennar_villages[ , c("x", "y")], pch = 20, cex = 0.5, col = "blue")
raster::plot(sp::HexPoints2SpatialPolygons(sennar_grid), border = "gray70", lwd = 1, add = TRUE)
```
